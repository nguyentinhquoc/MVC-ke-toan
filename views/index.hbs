<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">
        <div class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-gray-900 mb-4">{{title}}</h1>
            <p class="text-xl text-gray-600">{{message}}</p>
        </div>
        
        <!-- Upload Section -->
        <div class="bg-red rounded-lg shadow-lg p-8 mb-8 border-l-4 border-blue-500 hover:shadow-xl transition-shadow">
            <div class="flex items-center mb-6">
                <span class="text-3xl mr-3">üìä</span>
                <h2 class="text-2xl font-bold text-gray-900">T·∫£i l√™n File Excel</h2>
            </div>
            <form action="/upload-excel" method="POST" enctype="multipart/form-data" class="space-y-6">
                <div class="relative">
                    <input type="file" name="file" id="excelFile" accept=".xlsx,.xls" required class="hidden">
                    <label for="excelFile" class="flex flex-col items-center justify-center w-full px-6 py-12 border-2 border-dashed border-blue-300 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all duration-200 bg-gray-50" id="fileLabel">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <span class="text-5xl mb-3" id="fileIcon">üìÅ</span>
                            <p class="text-lg font-semibold text-gray-700" id="fileText">Ch·ªçn file Excel</p>
                            <p class="text-sm text-gray-500 mt-2" id="fileSubtext">.xlsx ho·∫∑c .xls</p>
                        </div>
                    </label>
                </div>
                 <div>
            <label for="tyGiaThayDoi" class="block mb-2.5 text-sm font-medium text-heading">T·ªâ gi√°</label>
            <input type="number" id="tyGiaThayDoi" name="tyGiaThayDoi" class="bg-neutral-secondary-medium border border-default-medium text-heading text-sm rounded-base focus:ring-brand focus:border-brand block w-full px-3 py-2.5 shadow-xs placeholder:text-body" placeholder="0.5" value="0.38" />
        </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md">T·∫£i l√™n v√† xem d·ªØ li·ªáu</button>
            </form>
        </div>
        {{#if excelData}}
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8 border-l-4 border-green-500 hover:shadow-xl transition-shadow">
            <div class="flex items-center mb-6">
                <span class="text-3xl mr-3">üìã</span>
                <div>
                    <h3 class="text-2xl font-bold text-gray-900">D·ªØ li·ªáu t·ª´ file Excel</h3>
                    <p class="text-sm text-gray-500 mt-1">File: <span class="font-semibold text-gray-700">{{fileName}}</span> | S·ªë d√≤ng: <span class="font-semibold text-gray-700">{{excelData.length}}</span></p>
                </div>
            </div>
            
            <div class="overflow-x-auto mb-6 max-h-100">
                <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden">
                    <thead class="bg-gradient-to-r from-green-500 to-emerald-600">
                        <tr>
                            {{#each excelData.[0]}}
                            <th class="px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">{{@key}}</th>
                            {{/each}}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {{#each excelData}}
                        <tr class="hover:bg-gray-50 transition-colors">
                            {{#each this}}
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{this}}</td>
                            {{/each}}
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md" onclick="exportTableToExcel('excelData', '{{fileName}}')">üì• Xu·∫•t Excel - D·ªØ li·ªáu g·ªëc</button>
        </div>
        {{/if}}
          {{#if excelDataKl}}
        <div class="w-full bg-white rounded-lg shadow-lg p-8 mb-8 border-l-4 border-amber-500 hover:shadow-xl transition-shadow">
            <div class="flex items-center mb-6">
                <span class="text-3xl mr-3">üë•</span>
                <div>
                    <h3 class="text-2xl font-bold text-gray-900">D·ªØ li·ªáu Kh√°ch l·∫ª</h3>
                    <p class="text-sm text-gray-500 mt-1">File: <span class="font-semibold text-gray-700">{{fileName}}</span> | S·ªë d√≤ng: <span class="font-semibold text-gray-700">{{excelDataKl.length}}</span></p>
                </div>
            </div>
            
            <div class="overflow-x-auto mb-6 max-h-200">

                <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden" id="excelDataKl">
                    <thead class="bg-gradient-to-r from-purple-500 to-pink-600">
                        <tr>
                            {{#each excelDataKl.[0]}}
                            <th class="px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">{{@key}}</th>
                            {{/each}}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {{#each excelDataKl}}
                        <tr class="hover:bg-gray-50 transition-colors">
                            {{#each this}}
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{this}}</td>
                            {{/each}}
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            <button class="bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md" onclick="exportTableToExcel('excelDataKl', 'Khach_Le_{{fileName}}')">üì• Xu·∫•t Excel - Kh√°ch L·∫ª</button>
        </div>
    {{/if}}
        {{#if excelDataTv}}
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8 border-l-4 border-amber-500 hover:shadow-xl transition-shadow">
            <div class="flex items-center mb-6">
                <span class="text-3xl mr-3">‚≠ê</span>
                <div>
                    <h3 class="text-2xl font-bold text-gray-900">D·ªØ li·ªáu Th·ªãnh V∆∞·ª£ng</h3>
                    <p class="text-sm text-gray-500 mt-1">File: <span class="font-semibold text-gray-700">{{fileName}}</span> | S·ªë d√≤ng: <span class="font-semibold text-gray-700">{{excelDataTv.length}}</span></p>
                </div>
            </div>
            
                        <div class="overflow-x-auto mb-6 max-h-200">

                <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg overflow-hidden" id="excelDataTv">
                    <thead class="bg-gradient-to-r from-amber-500 to-orange-600">
                        <tr>
                            {{#each excelDataTv.[0]}}
                            <th class="px-6 py-3 text-left text-xs font-bold text-white uppercase tracking-wider">{{@key}}</th>
                            {{/each}}
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {{#each excelDataTv}}
                        <tr class="hover:bg-gray-50 transition-colors">
                            {{#each this}}
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">{{this}}</td>
                            {{/each}}
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
            <button class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg transition-all duration-200 transform hover:scale-105 active:scale-95 shadow-md" onclick="exportTableToExcel('excelDataTv', 'Thinh_Vuong_{{fileName}}')">üì• Xu·∫•t Excel - Th·ªãnh V∆∞·ª£ng</button>
        </div>
    {{/if}}
    {{#if error}}
        <div class="bg-red-50 border-l-4 border-red-500 rounded-lg p-6 mb-8 shadow-md">
            <div class="flex items-center">
                <span class="text-3xl mr-3">‚ùå</span>
                <div>
                    <h3 class="text-lg font-bold text-red-900">L·ªói</h3>
                    <p class="text-red-700 mt-1">{{error}}</p>
                </div>
            </div>
        </div>
        {{/if}}
        
        <!-- Guide Section -->
        <div class="mt-10 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg shadow-lg p-8 border-l-4 border-blue-500">
            <div class="flex items-center mb-6">
                <span class="text-3xl mr-3">üí°</span>
                <h2 class="text-2xl font-bold text-gray-900">H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng</h2>
            </div>
            <ul class="space-y-3 text-gray-700">
                <li class="flex items-start">
                    <span class="text-blue-500 font-bold mr-3 text-lg">1.</span>
                    <span>Ch·ªçn file Excel (.xlsx ho·∫∑c .xls) t·ª´ m√°y t√≠nh c·ªßa b·∫°n</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-500 font-bold mr-3 text-lg">2.</span>
                    <span>Nh·∫•n n√∫t "T·∫£i l√™n v√† xem d·ªØ li·ªáu"</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-500 font-bold mr-3 text-lg">3.</span>
                    <span>D·ªØ li·ªáu t·ª´ sheet ƒë·∫ßu ti√™n s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã d∆∞·ªõi d·∫°ng b·∫£ng</span>
                </li>
                <li class="flex items-start">
                    <span class="text-blue-500 font-bold mr-3 text-lg">4.</span>
                    <span>H·ªó tr·ª£ t·∫•t c·∫£ c√°c ƒë·ªãnh d·∫°ng Excel ph·ªï bi·∫øn</span>
                </li>
            </ul>
        </div<li>H·ªó tr·ª£ t·∫•t c·∫£ c√°c ƒë·ªãnh d·∫°ng Excel ph·ªï bi·∫øn</li>
        </ul>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
// Handle file input change
document.getElementById('excelFile').addEventListener('change', function(e) {
    const fileName = this.files[0]?.name || '';
    const fileIcon = document.getElementById('fileIcon');
    const fileText = document.getElementById('fileText');
    const fileSubtext = document.getElementById('fileSubtext');
    
    if (fileName) {
        fileIcon.textContent = '‚úÖ';
        fileText.textContent = fileName;
        fileSubtext.textContent = 'S·∫µn s√†ng t·∫£i l√™n';
        fileSubtext.classList.remove('text-gray-500');
        fileSubtext.classList.add('text-green-600', 'font-semibold');
    } else {
        fileIcon.textContent = 'üìÅ';
        fileText.textContent = 'Ch·ªçn file Excel';
        fileSubtext.textContent = '.xlsx ho·∫∑c .xls';
        fileSubtext.classList.remove('text-green-600', 'font-semibold');
        fileSubtext.classList.add('text-gray-500');
    }
});

function exportTableToExcel(tableId, filename) {
    let table;
    
    if (tableId === 'excelDataKl') {
        table = document.querySelector('#excelDataKl');
    } else if (tableId === 'excelDataTv') {
        table = document.querySelector('#excelDataTv');
    } else {
        // L·∫•y b·∫£ng ƒë·∫ßu ti√™n (d·ªØ li·ªáu g·ªëc)
        table = document.querySelector('table');
    }
    
    if (!table) {
        alert('Kh√¥ng t√¨m th·∫•y b·∫£ng d·ªØ li·ªáu!');
        return;
    }
    
    // Create workbook and worksheet
    const wb = XLSX.utils.book_new();
    const ws = XLSX.utils.table_to_sheet(table);
    
    // Add worksheet to workbook
    XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
    
    // Generate filename
    const fileName = filename || 'export.xlsx';
    const finalFileName = fileName.replace('.xlsx', '') + '_export.xlsx';
    
    // Save file
    XLSX.writeFile(wb, finalFileName);
}
</script>
